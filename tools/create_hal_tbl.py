#!/usr/bin/env python

import re
import sys

comps = []

for infile in sys.argv[1:]:
    with open(infile) as f:
        pins = []
        compname = ''
        for line in f:
            comp = re.search('HAL_COMP\((\w*)\);', line)
            if comp:
                #comps.append(comp.groups())
                compname = comp.groups()[0]
            pin = re.search('HAL_PIN\((\w*)\)', line)
            if pin:
                pins.append(pin.groups()[0])
        comps.append((compname,pins))

#print "//generated by " + sys.argv[0] + " DO NOT EDIT"

for c in comps:
    print "struct " + c[0] + "_pin_ctx_t{"
    for p in c[1]:
        print "   hal_pin_inst_t " + p + ";"
    print "}"

for c in comps:
    print "extern " + c[0] + "_comp_struct;"

print "hal_comp_t comps[] = {"
for c in comps:
   print "   " + c[0] + "_comp_struct,"
print "}"

print "pin_t pins[] = {"
for c in comps:
    for p in c[1]:
        print "   \"" + p + "\","
print "}"

